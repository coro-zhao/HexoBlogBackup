---
title: Effective C++ 读书笔记(1)
date: 2018-11-09 23:32:29
tags: [Cpp,总结,程序开发]
---
## 前言

近段时间由于本人一直忙于导师的《系统工程》书籍部分章节的编写，公众号继续断更。现在静下心来总结，虽然在编写《系统工程》的时候遇到很多困难，因此在参阅了很多相关的文献书籍之后，对于导师说的“写一本通俗易懂的技术书籍需要反复推敲”这句话还是感触很深的。即使我现在有一点程序基础的人，也很难看得懂以前的厚厚的本科专业书（尤其是数据结构）。

因为我最近一直在研究C++相关的编写技巧，结合以前的项目经验、20多本系统工程软件工程经典书籍、《程序员面试宝典》，现主要围绕《Effective C++ 改善程序和设计的55个方法》这本书的内容说下软件设计。

<!-- more -->

## 浅谈C++

C++是一门难学易用的语言。C++是一种弱类型、静态语言。
![img](语言特性图.jpg)

我写过C++、PHP、Javascript、Python、Java、Object-C，其中只有C++跟Object-C给我感觉是具有较高的可读性，因为他们是静态语言，即编译器在编译的时候执行类型检查，虽然相比整体写起来会比较费劲，但可读性易维护性是非常高的。

Python就是典型的写起来爽，看起别人的代码却非常费劲的一门语言。因为深度学习的火热、Python也在这几年热度也很高，虽然人家在科学计算领域应用早就很普遍了，可能跟Matlab用法各方面很像。

讲回这个C++系列，《Effective C++》里提出了55条优化规则，我将用我自己的理解重新梳理一次。

## 少用#define

在网上开源代码，尤其是智能算法、BP神经网络代码，都习惯在头文件或者源文件头部写上#define一大堆参数常数。

#define AAA aaa 这个操作为预处理器操作，其原理流程为预处理器会将代码中相应的AAA参数替换成aaa，即编译器是无法看到AAA的，只能看到已经被预处理器替换（预处理）过的代码。

问题会出现在，若刚好这个常量出现了问题，编译器报出的错误信息就是aaa，而不是AAA。这样会造成一定的debug难度。

我在做智能算法仿真实验中，会频繁调整#define后的参数常数，会出现更改#define参数常数后无效的情况（即运行时参数还是未调整的参数），可能是VS的问题，所以每次运行之前都要rebuild整个工程。

解决的办法：对于单纯变量，可以利用const或enums；如果是函数，可以改用inline，降低我们对预处理器的需求。

下面重点讲一下const，在书中建议“尽可能使用const”，因为const是编译器的一个语义约束，如果在软件设计中某个变量初始化后不应该被改变，就应该加上const约束。如果不小心改动了具有const属性的变量，编译器肯定会报错，所以这个做法可以让代码更具有稳定性，以避免后续开发因不熟悉而破坏程序。

**static与const的组合**，是C++常考内容，这里不细说了。

加上static的变量具有静态属性，而且该无论该static变量是全局static变量还是局部static变量，都会存储在内存中的静态存储区，都会存放在内存空间直到程序结束才会被系统回收。

## 对象被使用前应先被初始化

还记得刚开始写程序的时候黑窗里的“烫烫烫烫……“吗？其实在VC的Debug模式下，对于未初始化的栈内存会全部填成0xcc，对应于汉字字符串看就是“烫”；对于未初始化的堆内存（手动new出来的）会全部填成 0xcd，对应于汉字字符串看就是“屯”。

这种情况尤其在class中尤为重要。书中提到：构造函数最好使用成员初值列（member initialzation list），而不要在构造函数本体内使用赋值操作（assignment）。尤其在提到，初值列列出的成员变量，其排列次序应该和他们在class内声明的次序相同。

这里附带说一下初值列与赋值的区别。赋值的例子与我们平常写代码的习惯是一样的，如下代码所示。

``` c++
class Demo {
    string _name;
    int _age;
    Word() {
        _name = 0;
        _age = 0;
    }
};
``` 

但使用初值列的写法如下代码所示。

``` c++
Demo::Demo() : _name(0), _age(0) {}
``` 

因为在编译器的赋值操作中，需要创建一个临时string，再赋值到_name中，最后释放那个临时string，所以初值列的操作效率是高于赋值操作的。

关于初始化问题，这边会扯到一个相关的知识点——**单例模式**（**Singleton**）。

单例模式的目的就是在程序中维护一个“类似”全局变量或对象，通常在客户端开发中用来存储一些程序状态变量或用户状态变量。

单例模式在C++中实现的关键点在于函数内的局部静态（local static）变量或对象会在首次调用该对象的时候被初始化，函数内部可以维持一个bool型的静态变量用于判断是否是首次调用该单例对象。调用后返回一个指向局部静态对象的引用（reference）。

常见的设计模式也是面试的高频题，常见设计模式有单例模式（Singleton）、工厂模式（Factory）、装饰者模式（Decorator）、建筑者模式（Builder）、代理模式、策略模式等。

这个系列文章的内容深度主要针对已经有一定编程基础并继续提高编程质量的读者。文章内容可能会比较短，但我也会尽量涉及C++的一些常规（有用的、项目实际会用到的）面试题，供大家参考讨论。


希望我有时间继续更下去。

## 相关参考：
1. https://blog.csdn.net/onever_say_love/article/details/50846213
2. https://www.zhihu.com/question/19918532
3. 《Effective C++ 改善程序和设计的55个方法》

## 文章来源为本人公众号，欢迎关注！
![img](/assets/img/qrcode_for_gh.jpg)
