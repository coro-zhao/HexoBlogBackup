title: 技术全靠吹--区块链基础介绍
date: 2018-02-24 02:26:16
tags: [区块链,程序开发,技术全靠吹]
---

## 前言

随着比特币热度大涨，区块链技术被各大媒体和公众号吹得神乎其神，更有人断言区块链即将改变未来金融方式。我对此非常感兴趣，所以趁着寒假空闲做了一段时间的搜索和研究。无可否认，基于区块链技术的数字货币有一定的技术意义，但当前也存在一些问题。

<!-- more -->

## 基础概念

**加密货币**：加密货币首先是一种数字货币，即可用于网络上进行交易活动的货币。

数字货币的例子就很多了，如Q币、某游戏点券和微信的余额等。有没有发现，数字货币例子里面都是某个特定公司发行并提供使用服务的，这种货币使用范围上具有局限性，如您充值购买的Q币只能购买腾讯的服务、某游戏点券只能购买相应游戏服务。可能你觉得微信余额用途相对较广，那是因为微信在中国用户中比较普及而已，其实你每一笔在微信的交易，都要求双方在微信平台内进行交易，包括你的交易记录、余额记录等都是存在于微信的服务器上。所以可以看到以前数字货币的共性——中心化。

比特币可以誉为一种真正的“货币”的数字货币。其最大的特点为“去中心化”，即在线交易过程不经过任何中间商（如支付宝、微信），就好像你平时用现金买东西一样，钱是直接从付款方到收款方的。

这时候就会有人问了：怎么才能够做到在线交易不通过中间商。其实早就有解决成熟的技术——P2P技术。

**P2P技术**：最早我们使用的种子下载，就是基于P2P网络的，现在很多下载工具都支持。它的好处就是“去中心化”。例如，你现在用迅雷下载一个文件，迅雷会帮你寻找到下载好的相同文件的迅雷用户，并一起为你的下载提供资源速度。一言蔽之就是网络上运行着Bit软件的电脑自动形成一个信息互通互助网络。（这就是为什么你开着迅雷，电脑会莫名地上传占据带宽爆炸）

**非对称加密**：先来说一个微博上的看到的笑话：说一对情侣把钱都投资在比特币上，女方保留公钥，男方保留私钥。
非对称加密的最大特点就是：公钥加密的内容，只能对应的私钥解开；私钥加密的内容，只有对应的公钥才能解开。这样的性质就保证了通讯的保密性和不可否认性（相比对称加密）。
在比特币里，公钥是私钥生成的，比特币钱包地址又是由公钥生成的。所以女方保存的公钥一点用没有，想使用钱包中的比特币还是需要男方的私钥解密。

**分布式数据库**：分布式数据库是指利用高速计算机网络将物理上分散的多个数据存储单元连接起来组成一个逻辑上统一的数据库。分布式数据库的基本思想是将原来集中式数据库中的数据分散存储到多个通过网络连接的数据存储节点上，以获取更大的存储容量和更高的并发访问量。（百度百科）
就区块链目前技术而言，分布式数据库是技术实现的基础。在比特币中，每个参与计算的比特币节点里都有一份完整的比特币交易记录副本（通俗地说就是每个参与者都有一份完整的交易账本）。在参与者数量较大的情况下，这样可以保证账本的完整性、不可否认性与安全性。

**共识机制**：也称为智能合约，是区块链技术中最大的创新点，也是分布式数据库最大的不同之处。共识机制说到底就是算法机制，性质与TCP网络协议类似，保证了整个区块链系统的正常运作。目前区块链较为流行的共识机制有工作量证明机制（POW）、股权证明机制（POS）、授权股权证明机制（DPOS）等。这才是区块链需要重点开发的地方。共识机制因为涉及社会学、经济学等范畴，所以这也是加密货币开发的难点。

## 基本架构

区块链，顾名思义就是由区块组成的链条，每个区块内部存储内容。如比特币等账本式的区块链，区块内部一般存储的就是交易信息，每个人的余额可由遍历一次账本可得。所以你拥有多少个比特币，并不是上面写着，而是通过遍历一次区块链上包含你手上的私钥对应的钱包地址的交易记录算出来的。

我参考了大部分网络上开源的区块链代码，下面简单阐述一下区块链的简单实现。

**块结构**
块结构最必要的部分：index（下标，记录这是第几个区块）、timestamp（时间戳，记录时间）、data（数据）、hash（本区块的哈希值）和 previous hash（前一个区块的哈希值）。

**块的产生**
除了“创世块”（第一个块，index为0）中previous hash部分为空，生成块的过程中均需要index、timestamp、data和previous hash。

**块的哈希值**
这是块生成的最后一步，利用index、timestamp、data和previous hash生成当前块的哈希值，并填入块的hash中。
“哈希”的定义因为比较基础，请自行百度。

**块的验证**
当一个结点生成一个新块时，它会在网络上散布这个块。如何保证这个块的完整性和被全网接受，需要一些程序策略。
完整性一般检查接收到的块中index值是否合法、根据index值判断块链上每个节点中的前后哈希值是否正确和判断块中的哈希值是否与块中记录的hash值一致等。
新的区块如何被全网接收，任何时候在链中都应该只有一组明确的块。万一冲突了，会选择有最大数目的块的链。简单来说，就是优先接受最长的链。在比特币中采用的是“六区确认”原则，即要多于六个区块才能被全网确认。（由此推算，比特币控制全网10分钟生成一个区块，六个区块即60分钟，换句话说你的交易至少需要一个小时才能被全网确认）

**节点通信**
上面介绍了P2P技术就是节点通信的技术基础，每个在线的节点需要与其他节点同步区块链数据。在目前的代码实现上主要简单实现三个功能：
* 某个节点上线，需要与其他节点同步当前区块链数据；
* 某个节点生成新的块，广播到所有其他节点；
* 某个节点接收到一个（对于本节点来说）新的块，添加块到链的后面。

**用户界面**
这属于软件前端范畴，主要给用户提供可视化界面来操作自身节点数据，功能简单包括：
* 查询当前区块链数据
* 写入块数据并生成新的块
* 接下来会介绍一下智能合约和目前的区块链应用平台。

## 相关参考：
1. 200行实现一个简单区块链 http://blog.jobbole.com/110860/
2. Node.js开发加密货币 http://bitcoin-on-nodejs.ebookchain.org/

## 文章来源为本人公众号，欢迎关注！
![img](/assets/img/qrcode_for_gh.jpg)
